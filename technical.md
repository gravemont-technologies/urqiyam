# Qiyam Technical Implementation Specification

## Architecture Overview
Qiyam is built as a highly responsive Progressive Web App (PWA) using the modern Next.js 14+ stack. It leverages server-side rendering for performance and SEO, with select client-side interactivity for the "app-like" experience (Quiz, Swipe).

## Stack Breakdown
- **Framework**: Next.js 16 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS v4
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **AI**: OpenAI API
- **Deployment**: Vercel

## Core Systems & Implementation

### 1. Authentication & Routing
- **Middleware**: `middleware.ts` handles session refresh and basic route protection.
- **Callback**: `app/auth/callback/route.ts` manages OAuth and Email link verification, enforcing the User State Machine (Landing -> Quiz -> Dashboard).
- **Public Routes**: `/`, `/login`, `/signup`
- **Protected Routes**: `/quiz`, `/ideas`, `/dashboard`

### 2. Database Schema (Supabase)
The database enforces data integrity and row-level security.
- `users`: Extends auth.users. Contains profile and `dna_json` (Quiz results).
- `ideas`: Generated by AI. Linked to users. Status tracking (pending/picked/rejected).
- `ventures`: Active commitments. Linked to ideas.
- policies: RLS ensures users only access their own data.

### 3. AI Integration Layer
- **Logic**: Abstracted in `lib/openai.ts` and `lib/prompts.ts`.
- **Generation**: Triggered via Server Actions or API Routes (`app/api/generate-ideas`).
- **Prompt Engineering**: Dynamic injection of User DNA into templates.

### 4. Frontend Components
- **Quiz**: Client-side form with state, submitting to DB via Server Actions.
- **IdeaSwipe**: Framer Motion powered card stack for "Tinder-like" interaction.
- **Dashboard**: Server Component fetching live metrics and active venture status.

## Data Flow
1. **User Sign Up** -> Auth User Created -> Email Verification.
2. **First Login** -> Callback checks `users` profile -> Redirects to `/quiz`.
3. **Quiz Submission** -> Updates `users.dna_json` -> Redirects to `/ideas`.
4. **Idea Generation** -> API calls OpenAI -> Populates `ideas` table.
5. **Idea Pick** -> Creates `ventures` row -> Redirects to `/dashboard`.
6. **Dashboard** -> Renders active venture and challenges.

## Security
- All sensitive logic (AI calls, DB writes) validated on server.
- RLS enabled on all tables.
- Env variables strict separation (`NEXT_PUBLIC` vs Secret).
